pipeline {
    agent any 

    environment {
        PROJECT_PATH = 'CSharp/DotNet5/WebApiApplication'
    }

    stages {
        stage('Restore Packages') {
            steps{
                echo '---- Restore Packages ----'
                dir("${env.PROJECT_PATH}"){
                    sh 'pwd'                
                    sh 'dotnet restore'
                }
            }
        }
        stage('Clean'){
            steps{
                echo '---- Clean ----'
                dir("${env.PROJECT_PATH}"){
                    sh 'dotnet clean WebApiApplication.csproj --configuration Release'
                }
            }
        }
        stage('Build'){
            steps{
                echo '---- Build ----'
                dir("${env.PROJECT_PATH}"){
                    sh 'dotnet build WebApiApplication.csproj --configuration Release --no-restore'
                }
            }
        }
        stage('Publish'){
            steps{
                echo '---- Publish ----'
                dir("${env.PROJECT_PATH}"){
                    sh 'dotnet publish WebApiApplication.csproj --configuration Release --no-restore'        
                }
            }
        }
    }
}